/*
 * jQuery imagesLoaded plugin v2.1.1
 * http://github.com/desandro/imagesloaded
 *
 * MIT License. by Paul Irish et al.
 */
(function(a,b){var c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.fn.imagesLoaded=function(l){var i=this,m=a.isFunction(a.Deferred)?a.Deferred():0,k=a.isFunction(m.notify),f=i.find("img").add(i.filter("img")),g=[],n=[],d=[];if(a.isPlainObject(l)){a.each(l,function(o,p){if(o==="callback"){l=p}else{if(m){m[o](p)}}})}function j(){var o=a(n),p=a(d);if(m){if(d.length){m.reject(f,o,p)}else{m.resolve(f)}}if(a.isFunction(l)){l.call(i,f,o,p)}}function e(o){h(o.target,o.type==="error")}function h(o,p){if(o.src===c||a.inArray(o,g)!==-1){return}g.push(o);if(p){d.push(o)}else{n.push(o)}a.data(o,"imagesLoaded",{isBroken:p,src:o.src});if(k){m.notifyWith(a(o),[p,f,a(n),a(d)])}if(f.length===g.length){setTimeout(j);f.unbind(".imagesLoaded",e)}}if(!f.length){j()}else{f.bind("load.imagesLoaded error.imagesLoaded",e).each(function(p,q){var r=q.src;var o=a.data(q,"imagesLoaded");if(o&&o.src===r){h(q,o.isBroken);return}if(q.complete&&q.naturalWidth!==b){h(q,q.naturalWidth===0||q.naturalHeight===0);return}if(q.readyState||q.complete){q.src=c;q.src=r}})}return m?m.promise(i):i}})(jQuery);L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:"Aerial",attribution:"Bing",culture:""},initialize:function(b,a){L.Util.setOptions(this,a);this._key=b;this._url=null;this.meta={};this.loadMetadata()},tile2quad:function(a,g,e){var c="";for(var d=e;d>0;d--){var f=0;var b=1<<(d-1);if((a&b)!=0){f+=1}if((g&b)!=0){f+=2}c=c+f}return c},getTileUrl:function(c,d){var d=this._getZoomForUrl();var b=this.options.subdomains,a=this.options.subdomains[Math.abs((c.x+c.y)%b.length)];return this._url.replace("{subdomain}",a).replace("{quadkey}",this.tile2quad(c.x,c.y,d)).replace("{culture}",this.options.culture)},loadMetadata:function(){var d=this;var b="_bing_metadata_"+L.Util.stamp(this);window[b]=function(g){d.meta=g;window[b]=undefined;var f=document.getElementById(b);f.parentNode.removeChild(f);if(g.errorDetails){alert("Got metadata"+g.errorDetails);return}d.initMetadata()};var a="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+b+"&key="+this._key;var c=document.createElement("script");c.type="text/javascript";c.src=a;c.id=b;document.getElementsByTagName("head")[0].appendChild(c)},initMetadata:function(){var e=this.meta.resourceSets[0].resources[0];this.options.subdomains=e.imageUrlSubdomains;this._url=e.imageUrl;this._providers=[];for(var d=0;d<e.imageryProviders.length;d++){var f=e.imageryProviders[d];for(var b=0;b<f.coverageAreas.length;b++){var h=f.coverageAreas[b];var g={zoomMin:h.zoomMin,zoomMax:h.zoomMax,active:false};var a=new L.LatLngBounds(new L.LatLng(h.bbox[0]+0.01,h.bbox[1]+0.01),new L.LatLng(h.bbox[2]-0.01,h.bbox[3]-0.01));g.bounds=a;g.attrib=f.attribution;this._providers.push(g)}}this._update()},_update:function(){if(this._url==null||!this._map){return}this._update_attribution();L.TileLayer.prototype._update.apply(this,[])},_update_attribution:function(){var a=this._map.getBounds();var c=this._map.getZoom();for(var b=0;b<this._providers.length;b++){var d=this._providers[b];if((c<=d.zoomMax&&c>=d.zoomMin)&&a.intersects(d.bounds)){if(!d.active){this._map.attributionControl.addAttribution(d.attrib)}d.active=true}else{if(d.active){this._map.attributionControl.removeAttribution(d.attrib)}d.active=false}}},onRemove:function(c){for(var a=0;a<this._providers.length;a++){var b=this._providers[a];if(b.active){this._map.attributionControl.removeAttribution(b.attrib);b.active=false}}L.TileLayer.prototype.onRemove.apply(this,[c])}});
/*
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */
(function(a,b){if(typeof exports==="object"&&exports){module.exports=b}else{if(typeof define==="function"&&define.amd){define(b)}else{a.Mustache=b}}}(this,(function(){var m={};m.name="mustache.js";m.version="0.7.2";m.tags=["{{","}}"];m.Scanner=r;m.Context=t;m.Writer=u;var d=/\s*/;var a=/\s+/;var b=/\S/;var g=/\s*=/;var n=/\s*\}/;var q=/#|\^|\/|>|\{|&|=|!/;var i=RegExp.prototype.test;var p=Object.prototype.toString;function v(y,x){return i.call(y,x)}function e(x){return !v(b,x)}var k=Array.isArray||function(x){return p.call(x)==="[object Array]"};function f(x){return x.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var h={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function w(x){return String(x).replace(/[&<>"'\/]/g,function(y){return h[y]})}m.escape=w;function r(x){this.string=x;this.tail=x;this.pos=0}r.prototype.eos=function(){return this.tail===""};r.prototype.scan=function(y){var x=this.tail.match(y);if(x&&x.index===0){this.tail=this.tail.substring(x[0].length);this.pos+=x[0].length;return x[0]}return""};r.prototype.scanUntil=function(y){var x,z=this.tail.search(y);switch(z){case -1:x=this.tail;this.pos+=this.tail.length;this.tail="";break;case 0:x="";break;default:x=this.tail.substring(0,z);this.tail=this.tail.substring(z);this.pos+=z}return x};function t(x,y){this.view=x;this.parent=y;this._cache={}}t.make=function(x){return(x instanceof t)?x:new t(x)};t.prototype.push=function(x){return new t(x,this)};t.prototype.lookup=function(x){var A=this._cache[x];if(!A){if(x=="."){A=this.view}else{var z=this;while(z){if(x.indexOf(".")>0){A=z.view;var B=x.split("."),y=0;while(A&&y<B.length){A=A[B[y++]]}}else{A=z.view[x]}if(A!=null){break}z=z.parent}}this._cache[x]=A}if(typeof A==="function"){A=A.call(this.view)}return A};function u(){this.clearCache()}u.prototype.clearCache=function(){this._cache={};this._partialCache={}};u.prototype.compile=function(x,y){var z=this._cache[x];if(!z){var A=m.parse(x,y);z=this._cache[x]=this.compileTokens(A,x)}return z};u.prototype.compilePartial=function(z,x,y){var A=this.compile(x,y);this._partialCache[z]=A;return A};u.prototype.getPartial=function(x){if(!(x in this._partialCache)&&this._loadPartial){this.compilePartial(x,this._loadPartial(x))}return this._partialCache[x]};u.prototype.compileTokens=function(z,y){var x=this;return function(A,C){if(C){if(typeof C==="function"){x._loadPartial=C}else{for(var B in C){x.compilePartial(B,C[B])}}}return o(z,x,t.make(A),y)}};u.prototype.render=function(y,x,z){return this.compile(y)(x,z)};function o(x,D,y,H){var A="";var z,F,G;for(var C=0,E=x.length;C<E;++C){z=x[C];F=z[1];switch(z[0]){case"#":G=y.lookup(F);if(typeof G==="object"){if(k(G)){for(var B=0,J=G.length;B<J;++B){A+=o(z[4],D,y.push(G[B]),H)}}else{if(G){A+=o(z[4],D,y.push(G),H)}}}else{if(typeof G==="function"){var I=H==null?null:H.slice(z[3],z[5]);G=G.call(y.view,I,function(K){return D.render(K,y)});if(G!=null){A+=G}}else{if(G){A+=o(z[4],D,y,H)}}}break;case"^":G=y.lookup(F);if(!G||(k(G)&&G.length===0)){A+=o(z[4],D,y,H)}break;case">":G=D.getPartial(F);if(typeof G==="function"){A+=G(y)}break;case"&":G=y.lookup(F);if(G!=null){A+=G}break;case"name":G=y.lookup(F);if(G!=null){A+=m.escape(G)}break;case"text":A+=F;break}}return A}function l(E){var y=[];var C=y;var D=[];var A;for(var z=0,x=E.length;z<x;++z){A=E[z];switch(A[0]){case"#":case"^":D.push(A);C.push(A);C=A[4]=[];break;case"/":var B=D.pop();B[5]=A[2];C=D.length>0?D[D.length-1][4]:y;break;default:C.push(A)}}return y}function j(C){var B=[];var A,y;for(var z=0,x=C.length;z<x;++z){A=C[z];if(A){if(A[0]==="text"&&y&&y[0]==="text"){y[1]+=A[1];y[3]=A[3]}else{y=A;B.push(A)}}}return B}function s(x){return[new RegExp(f(x[0])+"\\s*"),new RegExp("\\s*"+f(x[1]))]}m.parse=function(F,E){F=F||"";E=E||m.tags;if(typeof E==="string"){E=E.split(a)}if(E.length!==2){throw new Error("Invalid tags: "+E.join(", "))}var N=s(E);var B=new r(F);var G=[];var P=[];var y=[];var D=false;var O=false;function I(){if(D&&!O){while(y.length){delete P[y.pop()]}}else{y=[]}D=false;O=false}var A,z,H,J,C;while(!B.eos()){A=B.pos;H=B.scanUntil(N[0]);if(H){for(var K=0,M=H.length;K<M;++K){J=H.charAt(K);if(e(J)){y.push(P.length)}else{O=true}P.push(["text",J,A,A+1]);A+=1;if(J=="\n"){I()}}}if(!B.scan(N[0])){break}D=true;z=B.scan(q)||"name";B.scan(d);if(z==="="){H=B.scanUntil(g);B.scan(g);B.scanUntil(N[1])}else{if(z==="{"){H=B.scanUntil(new RegExp("\\s*"+f("}"+E[1])));B.scan(n);B.scanUntil(N[1]);z="&"}else{H=B.scanUntil(N[1])}}if(!B.scan(N[1])){throw new Error("Unclosed tag at "+B.pos)}C=[z,H,A,B.pos];P.push(C);if(z==="#"||z==="^"){G.push(C)}else{if(z==="/"){if(G.length===0){throw new Error('Unopened section "'+H+'" at '+A)}var x=G.pop();if(x[1]!==H){throw new Error('Unclosed section "'+x[1]+'" at '+A)}}else{if(z==="name"||z==="{"||z==="&"){O=true}else{if(z==="="){E=H.split(a);if(E.length!==2){throw new Error("Invalid tags at "+A+": "+E.join(", "))}N=s(E)}}}}}var x=G.pop();if(x){throw new Error('Unclosed section "'+x[1]+'" at '+B.pos)}P=j(P);return l(P)};var c=new u();m.clearCache=function(){return c.clearCache()};m.compile=function(x,y){return c.compile(x,y)};m.compilePartial=function(z,x,y){return c.compilePartial(z,x,y)};m.compileTokens=function(y,x){return c.compileTokens(y,x)};m.render=function(y,x,z){return c.render(y,x,z)};m.to_html=function(y,x,z,B){var A=m.render(y,x,z);if(typeof B==="function"){B(A)}else{return A}};return m}())));(function(b,a){b.extend(a.viewmodel,{version:null});b.extend(a.view,{$document:null});a.loader={};b.extend(a.loader,{templates:["uikPopupTemplate","uikPopupInfoTemplate","searchResultsTemplate","userLogsTemplate","alertsTemplate"],init:function(){var c=this;this.setDomOptions();window.setTimeout(function(){c.initModules();b("img").imagesLoaded(function(){a.view.$body.removeClass("loading")})},1000)},initModules:function(){try{a.common.init();a.alerts.init();a.permalink.init();a.map.init();a.searcher.init();a.searcher.tab.init();a.editor.init();a.user.init();a.uiks.init();a.uiks_2012.init();a.josm.init();a.editor.tab.init()}catch(c){alert(c)}},setDomOptions:function(){a.view.$document=b(document)}});b(document).ready(function(){a.loader.init()})})(jQuery,UIK);(function(b,a){a.helpers={};b.extend(a.helpers,{getIcon:function(c,d){return L.divIcon({className:c,iconSize:[d,d],iconAnchor:[d/2,d/2],popupAnchor:[0,2-(d/2)]})},hashToArrayKeyValues:function(d){var c=[];if(Object.prototype.toString.call(d)==="[object Array]"){return d}for(var e in d){if(!d.hasOwnProperty(e)){continue}c.push({key:e,val:d[e]})}return c},boolToString:function(d,c){switch(d){case null:return c?"null":"";break;case true:return c?"true":"Да";break;case false:return c?"false":"Нет";break}throw"The bool value is not convertible to string"},valueNullToString:function(c){if(c===null){return""}return c},sortByFields:function(){var d=arguments,c=this;return function(j,h){var e=0,g=0,f=d.length;while(g===0&&e<f){g=c.dynamicSort(d[e])(j,h);e++}return g}},dynamicSort:function(c){var d=1;if(c[0]==="-"){d=-1;c=c.substr(1,c.length-1)}return function(f,e){var g=(f[c]<e[c])?-1:(f[c]>e[c])?1:0;return g*d}}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{bodyPanelsVisible:[true,true,true,true]});b.extend(a.view,{$body:null,$popup:null});a.common={};b.extend(a.common,{init:function(){this.setDomOptions();this.bindEvents()},bindEvents:function(){var c=this;a.view.$document.on("/sm/common/openPopup",function(g,f,d){c.openPopup(f,d)});a.view.$popup.find("a.close").off("click").on("click",function(){a.view.$body.removeClass("popup")});a.view.$document.on("/sm/common/setMainLoad",function(){a.view.$body.addClass("loader")})},openPopup:function(f,d){var g=a.view.$popup,e,c;g.find("div.header").text(f);g.find("div.content").html(d);e=g.width()/2;c=g.height()/2;g.css({"margin-left":-e+"px","margin-top":-c+"px"});a.view.$body.addClass("popup")},closePopup:function(){},setDomOptions:function(){a.view.$body=b("body");a.view.$popup=b("#popup")}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{map:null,mapLayers:{},isPopupOpened:false});b.extend(a.view,{$map:null});a.map={};b.extend(a.map,{defaultExtent:{latlng:new L.LatLng(55.742,37.658),zoom:17},init:function(){this.buildMap();this.buildLayerManager();this.buildLayers();a.map.lockHistory=false;a.map.extentHistory=[];a.map.extentHistoryPointer=-1;this.pushCurrentExtent();this.bindEvents();a.alerts.showAlert("historyShortcuts")},bindEvents:function(){var c=this;a.viewmodel.map.on("moveend",function(h){var g=h.target,f=g.getCenter(),d=g.getZoom();c.setLastExtentToCookie(f,d);a.map.pushCurrentExtent();a.view.$document.trigger("/uik/permalink/update",[f,d]);a.view.$document.trigger("/uik/map/updateAllLayers")});a.view.$document.on("/uik/map/updateAllLayers",function(){a.view.$document.trigger("/uik/uiks_2012/updateUiks");a.view.$document.trigger("/uik/uiks/updateUiks")});a.view.$document.on("/uik/map/openPopup",function(j,i,f){var g=a.viewmodel,d=g.mapLayers.select,h=g.map;h.panTo(i);h.openPopup(L.popup().setLatLng(i).setContent(f))});a.viewmodel.map.on("popupclose",function(){var d=a.viewmodel;d.isPopupOpened=false;d.mapLayers.select.clearLayers()});b("#map").keydown(function(d){if(d.keyCode==80){a.map.backwardExtentHistory()}if(d.keyCode==78){a.map.forwardExtentHistory()}})},pushCurrentExtent:function(){var c=[a.viewmodel.map.getCenter(),a.viewmodel.map.getZoom()];if(a.map.extentHistoryPointer>=0&&a.map.extentHistory[a.map.extentHistoryPointer][0].lat==c[0].lat&&a.map.extentHistory[a.map.extentHistoryPointer][0].lng==c[0].lng&&a.map.extentHistory[a.map.extentHistoryPointer][1]==c[1]){return}while(a.map.extentHistory.length-1>a.map.extentHistoryPointer){a.map.extentHistory.pop()}a.map.extentHistory.push(c);a.map.extentHistoryPointer++},backwardExtentHistory:function(){if(a.map.extentHistoryPointer>0){a.map.extentHistoryPointer-=1;var c=a.map.extentHistory[a.map.extentHistoryPointer];a.map.lockHistory=true;a.viewmodel.map.setView(c[0],c[1]);a.map.lockHistory=false}},forwardExtentHistory:function(){if(a.map.extentHistoryPointer+1<a.map.extentHistory.length){a.map.extentHistoryPointer+=1;var c=a.map.extentHistory[a.map.extentHistoryPointer];a.map.lockHistory=true;a.viewmodel.map.setView(c[0],c[1]);a.map.lockHistory=false}},buildMap:function(){var e=a.viewmodel,d=this.getExtentFromUrl(),c;a.view.$map=b("#map");e.map=new L.Map("map");L.control.scale().addTo(e.map);if(d){e.map.setView(d.latlng,d.zoom);this.setLastExtentToCookie(d.latlng,d.zoom)}else{lastExtent=this.getLastExtentFromCookie();if(lastExtent){e.map.setView(lastExtent.latlng,lastExtent.zoom)}else{e.map.setView(this.defaultExtent.latlng,this.defaultExtent.zoom);this.setLastExtentToCookie(this.defaultExtent.latlng,this.defaultExtent.zoom)}}a.view.$document.trigger("/uik/permalink/update",[e.map.getCenter(),e.map.getZoom()]);c=L.layerGroup();e.map.addLayer(c);e.mapLayers.select=c},buildLayers:function(){var g=a.config.data.points,e,f,d,c={},h=[];a.viewmodel.mapLayers.points={};for(e in g){if(g.hasOwnProperty(e)){f=g[e].createLayer();a.viewmodel.map.addLayer(f);a.viewmodel.mapLayers.points[e]=f;c[g[e].z]=e;h.push(g[e].z)}}h.sort(function(j,i){return i-j});b.each(h,function(j,k){a.viewmodel.mapLayers.points[c[k]].bringToFront()})},getLastExtentFromCookie:function(){var e=parseFloat(b.cookie("map.lat"),10),c=parseFloat(b.cookie("map.lng"),10),d=parseInt(b.cookie("map.zoom"),10);if(e&&c&&d){return{latlng:new L.LatLng(e,c),zoom:d}}else{return null}},setLastExtentToCookie:function(c,d){b.cookie("map.lat",c.lat,{expires:7,path:"/"});b.cookie("map.lng",c.lng,{expires:7,path:"/"});b.cookie("map.zoom",d,{expires:7,path:"/"})},getExtentFromUrl:function(){var e=parseFloat(this.getURLParameter("lat")),c=parseFloat(this.getURLParameter("lon")),d=parseFloat(this.getURLParameter("zoom"));if(e&&c&&d){return{latlng:new L.LatLng(e,c),zoom:d}}return null},getURLParameter:function(c){return decodeURI((RegExp(c+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}})})(jQuery,UIK);(function(b,a){b.extend(a.map,{getIcon:function(c,d){return L.divIcon({className:c,iconSize:[d,d],iconAnchor:[d/2,d/2],popupAnchor:[0,2-(d/2)]})}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{currentTileLayer:null});b.extend(a.view,{$tileLayers:null,$manager:null});b.extend(a.map,{_layers:{},_lastIndex:0,buildLayerManager:function(){var c=a.view;a.view.$manager=b("#manager");this.addTileLayer("osm","http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png","© OpenStreetMap contributors");this.addBingLayer("AujH--7B6FRTK8b81QgPhuvw_Sb3kc8hBO-Lp5OLNyhCD4ZQoGGW4cQS6zBgaeEh");a.view.$tileLayers=c.$map.find("div.leaflet-tile-pane div.leaflet-layer");this.bindLayerManagerEvents();this.onLayer("osm")},bindLayerManagerEvents:function(){var c=this;a.viewmodel.map.off("zoomend").on("zoomend",function(){c.onLayer()});a.view.$manager.find("div.tile-layers div.icon").off("click").on("click",function(d){c.onLayer(b(this).data("layer"))})},onLayer:function(e){var d=a.viewmodel,c=a.view,f=b(a.viewmodel.map.getPanes().tilePane).find("div.leaflet-layer");if(e){c.$body.removeClass(d.currentTileLayer).addClass(e);d.currentTileLayer=e;f.hide().eq(this._layers[e].index).show()}else{f.hide().eq(this._layers[d.currentTileLayer].index).show()}},addTileLayer:function(f,c,e){var d=new L.TileLayer(c,{minZoom:8,maxZoom:18,attribution:e});this._layers[f]={layer:a.viewmodel.map.addLayer(d,true),index:this._lastIndex};this._lastIndex=+1},addBingLayer:function(d){var c=new L.BingLayer(d,{minZoom:8,maxZoom:19});this._layers.bing={layer:a.viewmodel.map.addLayer(c,true),index:this._lastIndex};this._lastIndex=+1}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{searcherCollapsed:false,filter:{},isFilterValidated:true});b.extend(a.view,{$searchContainer:null,$filterName:null,$$filterAddr:null,$searchButton:null,$uiksSearchResults:null,$uikspSearchResults:null,$clearSearch:null});a.searcher={};b.extend(a.searcher,{min_characters_count:3,init:function(){this.setDomOptions();this.initFilter();this.bindEvents()},setDomOptions:function(){var c=a.view;c.$searchContainer=b("#searchContainer");c.$filterName=b("#filter_name");c.$filterAddr=b("#filter_address");c.$searchButton=b("#search");c.$uiksSearchResults=b("#searchUIK").find("div.searchResults");c.$uikspSearchResults=b("#searchUIK_2012").find("div.searchResults");c.$clearSearch=c.$searchContainer.find("a.clear-search")},initFilter:function(){var g=this,d=a.view,f,i,c,h,j,e;d.$searchContainer.find("div.search-block").each(function(k){f=b(this);i=f.data("filter");e=a.viewmodel.filter;e[i]={};e[i].json={};e[i].is_valid=true;e[i].trigger=f.data("trigger");e[i].btn_search=f.find("div.search");e[i].clear_search=f.find("a.clear-search");e[i].elements={};f.find("input.filterable").each(function(){(function(m,n,l){c=b(m);h=c.data("filter");a.viewmodel.filter[n].elements[h]={element:c,is_valid:true};l[n].json[h]=""})(this,i,e)})})},bindEvents:function(){var c=a.view,d=this;this.bindKeyUpHandlers();c.$searchContainer.find("span.icon-collapse, div.title").off("click").on("click",function(){a.viewmodel.searcherCollapsed=!a.viewmodel.searcherCollapsed;a.view.$body.toggleClass("searcher-collapsed",d.searcherCollapsed)});c.$document.on("/sm/searcher/update",function(){d.updateSearch()})},bindKeyUpHandlers:function(){var d=this,g=a.viewmodel.filter,f,i,e,k,j,c,h;for(i in g){if(g.hasOwnProperty(i)){f=g[i];for(k in f.elements){if(f.elements.hasOwnProperty(k)){e=f.elements[k].element;(function(l,n,m){l.off("keyup").on("keyup",function(o){h=b(this);if(o.keyCode===13){if(m.validateFilter(n)){m.applyFilter(n)}}else{j=m[h.data("validate")](h.val());h.toggleClass("invalid",!j);n.elements[k].is_valid=j;c=m.validateFilter(n);n.btn_search.toggleClass("active",c);if(c){m.buildFilterJson(n)}if(c&&m.isEmptyFilters(n)){n.btn_search.removeClass("active")}}});n.clear_search.off("click").on("click",function(){b.each(n.elements,function(){this.element.val("")});m.applyFilter(n)});n.btn_search.off("click").on("click",function(){if(b(this).hasClass("active")){m.applyFilter(n)}})})(e,f,d)}}}}},validateFilter:function(e){var d=e.elements,c;for(c in d){if(d.hasOwnProperty(c)&&!d[c].is_valid){e.is_valid=false;return false}}e.is_valid=true;return true},isEmptyFilters:function(e){var d=e.elements,c;for(c in d){if(d.hasOwnProperty(c)){if(b.trim(d[c].element.val())!==""){return false}}}return true},validateDefault:function(d){var c=b.trim(d);return c.length>this.min_characters_count||c===""},validateNumber:function(d){var c=b.trim(d);return c.length>2||c===""},applyFilter:function(c){this.buildFilterJson(c);this.search(c)},buildFilterJson:function(e){var d=e.elements,c;for(c in d){if(d.hasOwnProperty(c)){e.json[c]=b.trim(d[c].element.val())}}},search:function(c){a.view.$document.trigger(c.trigger)},updateSearch:function(){var d=a.viewmodel.pointLayers.uiks,c=a.config.data.points,g,f=a.view.$uiksSearchResults.find("div"),e;f.empty();for(g in d){if(d.hasOwnProperty(g)){e=this.getHtmlForSearchResults(c[g].searchCssClass,d[g].elements);f.append(e)}}f.find("a.target").on("click",function(){var h=b(this).parent();a.viewmodel.map.setView(new L.LatLng(h.data("lat"),h.data("lon")),18);b("#target").show().delay(1000).fadeOut(1000)});f.find("a.edit").on("click",function(){if(a.viewmodel.editable){return false}var i=b(this).parent(),h;a.viewmodel.map.setView(new L.LatLng(i.data("lat"),i.data("lon")),18);b("#target").show().delay(1000).fadeOut(1000);h=i.data("id");b.getJSON(document.url_root+"uik/"+h,function(j){if(!a.viewmodel.editable){a.viewmodel.uikSelected=j;a.view.$document.trigger("/uik/editor/startEdit")}})});f.prop("class","active");f=a.view.$uikspSearchResults.find("div");d=a.viewmodel.pointLayers.uiksp;f.empty();for(g in d){if(d.hasOwnProperty(g)){e=a.templates.searchResultsTemplate({cssClass:c[g].searchCssClass,uiks:d[g].elements,isAuth:false});f.append(e)}}f.find("a.target").on("click",function(){var h=b(this).parent();a.viewmodel.map.setView(new L.LatLng(h.data("lat"),h.data("lon")),18);b("#target").show().delay(1000).fadeOut(1000)});f.prop("class","active")},getHtmlForSearchResults:function(c,d){return a.templates.searchResultsTemplate({cssClass:c,uiks:d,isAuth:a.viewmodel.isAuth})}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{});b.extend(a.view,{$activatedSearchTab:null});a.searcher.tab={};b.extend(a.searcher.tab,{init:function(){this.setDomOptions();this.bindEvents()},setDomOptions:function(){a.view.$activatedSearchTab=a.view.$searchContainer.find("ul.nav li.active")},bindEvents:function(){var c=this,d;a.view.$searchContainer.find("ul.nav li").off("click").on("click",function(f){d=b(this);if(d.data("id")!==a.view.$activatedSearchTab.data("id")){c.activateTab(d)}})},activateTab:function(d){var c=a.view;c.$activatedSearchTab.removeClass("active");c.$activatedSearchTab=d.addClass("active");c.$searchContainer.attr("class",d.data("id"))}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{editorCollapsed:false,editable:false,latlngEditable:{lat:{validated:null,marker:null,editor:null},lng:{validated:null,marker:null,editor:null},isNeedApplied:false,sourceCoordinates:null},markerEditable:null});b.extend(a.view,{$editorContainer:null});a.editor={};b.extend(a.editor,{regex:{url:new RegExp("(https?)://[-A-Za-z0-9+&@#/%?=~_|!:,.;]*[-A-Za-z0-9+&@#/%=~_|]")},precisionDegree:6,init:function(){this.setDomOptions();this.buildEditLayer();this.bindEvents()},setDomOptions:function(){a.view.$editorContainer=b("#editorContainer");a.viewmodel.editorCollapsed=a.view.$body.hasClass("editor-collapsed")},buildEditLayer:function(){var c=L.layerGroup();a.viewmodel.mapLayers.edit=c;a.viewmodel.map.addLayer(c)},bindEvents:function(){var c=this;a.view.$editorContainer.find("span.icon-collapse, div.title").off("click").on("click",function(){c.toggleEditor()});a.view.$document.on("/uik/editor/startEdit",function(d){c.startAjaxEdition()});b("#save").off("click").on("click",function(d){d.stopPropagation();c.save()});b("#discard").off("click").on("click",function(d){var f=a.viewmodel;d.stopPropagation();if(!f.latlngEditable.sourceCoordinates.equals(f.markerEditable.getLatLng())){f.map.setView(f.latlngEditable.sourceCoordinates,18);b("#target").show().delay(1000).fadeOut(1000)}c.finishAjaxEdition()});b("#editorForm").find(":checkbox").off("click").on("click",function(){var e=b(this),d=b("#"+e.data("id"));if(e.is(":checked")){d.val(1)}else{d.val(0)}});b("#lat, #lng").off("keyup").on("keyup",function(d){c.coordinatesInputHandler(d,b(this))});b("#applyCoordinates").off("click").on("click",function(){c.applyCoordinates(a.viewmodel.latlngEditable)});b("#undoCoordinates").off("click").on("click",function(){c.undoCoordinates()});b("#resetCenter").off("click").on("click",function(){c.resetCenter()})},toggleEditor:function(){var c=!a.viewmodel.editorCollapsed;a.viewmodel.editorCollapsed=c;a.view.$body.toggleClass("editor-collapsed",c)},coordinatesInputHandler:function(g,h){var d=h.attr("id"),j=h.val(),i=a.viewmodel.latlngEditable,l=i[d],c=l.validated,k=l.editor!==l.marker,f=i.isNeedApplied;if(g.keyCode===13){if(i.isNeedApplied){this.applyCoordinates(i)}}else{l.validated=this.verifyDecimalDegree(j);if(l.validated){j=parseFloat(j.replace(",",".")).toFixed(this.precisionDegree);l.editor=j}else{a.alerts.showAlert("validateCoordinatesError")}i.isNeedApplied=this.getIsCanApplied(i);if(f!==i.isNeedApplied){b("#applyCoordinates").prop("disabled",!i.isNeedApplied)}if(i.isNeedApplied){a.alerts.showAlert("changeCoordinates")}if(c!==l.validated){h.toggleClass("invalid",!l.validated)}else{if(k!==(l.editor!==l.marker)){h.toggleClass("need-apply",l.editor!==l.marker)}}}},getIsCanApplied:function(c){if(!c.lat.validated||!c.lng.validated){return false}return c.lat.editor!==c.lat.marker||c.lng.editor!==c.lng.marker},verifyDecimalDegree:function(c){return !/^\s*$/.test(c)&&!isNaN(c)},applyCoordinates:function(c){var e=a.viewmodel,d=new L.LatLng(parseFloat(c.lat.editor),parseFloat(c.lng.editor));this.updateCoordinates(d);e.markerEditable.setLatLng(d);e.map.setView(d,18);b("#target").show().delay(1000).fadeOut(1000);b("#lat, #lng").removeClass("need-apply");b("#undoCoordinates").prop("disabled",false)},undoCoordinates:function(){var d=a.viewmodel,c=new L.LatLng(d.uikSelected.uik.old_geom.lat,d.uikSelected.uik.old_geom.lng);this.updateCoordinates(c);d.markerEditable.setLatLng(c);d.map.setView(c,d.map.getZoom());b("#undoCoordinates").prop("disabled",true)},resetCenter:function(){var c=a.viewmodel.map.getCenter();this.updateCoordinates(c);a.viewmodel.markerEditable.setLatLng(c);b("#undoCoordinates").prop("disabled",false)},startAjaxEdition:function(){var c=this;b.ajax({type:"GET",url:document.url_root+"uik/block/"+a.viewmodel.uikSelected.uik.id}).done(function(){c.startEdit()})},startEdit:function(){var d=a.viewmodel,c=a.view;c.$body.addClass("editable");if(d.editorCollapsed){this.toggleEditor()}c.$editorContainer.find("input, select, textarea, button").removeAttr("disabled");c.$editorContainer.find("form").removeClass("disabled");d.editable=true;this.startEditingGeometry(d.uikSelected.uik.geom.lat,d.uikSelected.uik.geom.lng);this.fillEditor(d.uikSelected);d.uikSelected.uik.old_geom=jQuery.extend({},d.uikSelected.uik.geom);a.uiks.versions.showVersions();d.map.closePopup();b("#editUIK-link").click()},startEditingGeometry:function(h,d){var e=this,f=L.marker([h,d],{icon:a.helpers.getIcon("stop-editable",25),draggable:true}),g=h.toFixed(this.precisionDegree),c=d.toFixed(this.precisionDegree);f.on("dragend",function(i){e.updateCoordinates(i.target.getLatLng());b("#undoCoordinates").prop("disabled",false)});a.viewmodel.mapLayers.edit.addLayer(f);b("#applyCoordinates").prop("disabled",true);b("#undoCoordinates").prop("disabled",true);a.viewmodel.latlngEditable={lat:{validated:true,marker:g,editor:g},lng:{validated:true,marker:c,editor:c},isNeedApplied:false,sourceCoordinates:new L.LatLng(h,d)};a.viewmodel.markerEditable=f},updateCoordinates:function(d){var g=d.lat.toFixed(this.precisionDegree),f=d.lng.toFixed(this.precisionDegree),h=a.viewmodel,c=h.latlngEditable.isNeedApplied,e=h.latlngEditable.sourceCoordinates;h.uikSelected.uik.geom.lat=d.lat;h.uikSelected.uik.geom.lng=d.lng;if(c){b("#applyCoordinates").prop("disabled",true)}h.latlngEditable={lat:{validated:true,marker:g,editor:g},lng:{validated:true,marker:f,editor:f},isNeedApplied:false,sourceCoordinates:e};b("#lat").val(g);b("#lng").val(f)},fillEditor:function(d){var c=a.helpers;b("#id").val(d.uik.id).attr("disabled","disabled");b("#name").val(d.uik.number_official).attr("disabled","disabled");b("#region").val(d.region.name).attr("disabled","disabled");b("#tik").val(d.tik.name).attr("disabled","disabled");b("#address_voting").val(c.valueNullToString(d.uik.address_voting));b("#place_voting").val(c.valueNullToString(d.uik.place_voting));b("#geo_precision option:eq("+d.geo_precision.id+")").prop("selected",true);b("#lat").val(d.uik.geom.lat.toFixed(this.precisionDegree));b("#lng").val(d.uik.geom.lng.toFixed(this.precisionDegree));b("#comment").val(c.valueNullToString(d.uik.comment));if(d.uik.is_applied){b("#is_applied").val(1);b("#chb_is_applied").prop("checked",true)}else{b("#is_applied").val(0);b("#chb_is_applied").prop("checked",false)}},save:function(){if(!this.verifyEditor()){return}var f=this,j=b("#editorContainer form"),k=j.serializeArray(),h=k.length,g=a.viewmodel.uikSelected,d={id:g.uik.id},c=document.url_root+"uik/"+d.id,e=0;for(e;e<h;e+=1){d[k[e].name]=k[e].value}d.geom=g.uik.geom;b.ajax({type:"POST",url:c,data:{uik:JSON.stringify(d)}}).done(function(){a.alerts.showAlert("saveSuccessful");f.finishEditing()}).error(function(){a.alerts.showAlert("saveError")})},verifyEditor:function(){var d=true,c=a.viewmodel.latlngEditable;if(c.isNeedApplied){d=false;a.alerts.showAlert("notAppliedCoordinates")}if(!c.lat.validated||!c.lng.validated){d=false;a.alerts.showAlert("validateCoordinatesError")}return d},finishAjaxEdition:function(){var c=this;b.ajax({type:"GET",url:document.url_root+"uik/unblock/"+a.viewmodel.uikSelected.uik.id}).done(function(){c.finishEditing()})},finishEditing:function(){var d=a.viewmodel,c=a.view;d.map.closePopup();d.mapLayers.edit.clearLayers();d.editable=false;c.$body.addClass("editable");c.$editorContainer.find("input, textarea").val("");c.$editorContainer.find("input:checkbox").prop("checked",false);c.$editorContainer.find("input, select, textarea, button").attr("disabled","disabled").removeClass("invalid");c.$editorContainer.find("form").addClass("disabled");a.view.$document.trigger("/uik/map/updateAllLayers")}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{uikSelected:null,uikSelectedId:null,pointLayers:{}});b.extend(a.view,{});a.uiks={};b.extend(a.uiks,{init:function(){this.updatePoints();this.bindEvents()},bindEvents:function(){var c=this;a.view.$document.on("/uik/uiks/updateUiks",function(){c.updatePoints()})},updatePoints:function(){var c=this.validateZoom();this.clearLayers();if(!c){return}a.view.$document.trigger("/uik/uiks/startUpdate");this.updateUiksByAjax()},clearLayers:function(){var c=a.viewmodel.mapLayers;c.points.checked.clearLayers();c.points.unchecked.clearLayers();c.points.blocked.clearLayers()},updateUiksByAjax:function(){var e=this,d=document.url_root+"uik/all",c=a.viewmodel.filter,f={uik:c.uik.json,uik_2012:c.uik_2012.json};b.ajax({type:"GET",url:d,data:{bbox:JSON.stringify(a.viewmodel.map.getBounds()),center:JSON.stringify(a.viewmodel.map.getCenter()),filter:JSON.stringify(f)},dataType:"json",success:function(g){e.renderUiks(g);a.view.$document.trigger("/sm/searcher/update");a.view.$document.trigger("/sm/stops/endUpdate")},context:e})},renderUiks:function(h){var k=a.viewmodel,q=k.mapLayers.points,n=a.config.data.points,o=h.data.points.layers,p,g,m,j,l,d,f,e=a.templates.uikPopupTemplate({css:"edit"}),c=this;k.pointLayers.uiks=h.data.points.layers;for(p in o){if(o.hasOwnProperty(p)){g=o[p].elements;m=o[p].count;if(m>0){l=n[p].createIcon()}for(f=0;f<m;f+=1){j=g[f];d=L.marker([j.lat,j.lon],{icon:l}).on("click",function(r){var i=r.target;a.view.$document.trigger("/uik/map/openPopup",[i.getLatLng(),e]);c.buildUikPopup(i.id)});d.id=j.id;q[p].addLayer(d)}}}},buildUikPopup:function(c){return b.getJSON(document.url_root+"uik/"+c,function(e){if(!a.viewmodel.editable){a.viewmodel.uikSelected=e}var d=a.templates.uikPopupInfoTemplate({uik:e.uik,tik:e.tik,region:e.region,geo_precision:e.geo_precision,isUserEditor:a.viewmodel.isAuth,editDenied:a.viewmodel.editable||e.uik.is_blocked,isBlocked:e.uik.is_blocked,userBlocked:e.uik.user_blocked,isUnBlocked:e.uik.is_unblocked});b("#uik-popup").removeClass("loader").empty().append(d);b("button#edit").off("click").on("click",function(){a.view.$document.trigger("/uik/editor/startEdit")});if(e.uik.is_unblocked){b("#unblock").off("click").on("click",function(){b.ajax({type:"GET",url:document.url_root+"uik/unblock/"+a.viewmodel.uikSelected.uik.id}).done(function(){a.viewmodel.map.closePopup();a.view.$document.trigger("/uik/map/updateAllLayers")})})}a.uiks.versions.showVersions();b("#versionsUIK-link").click()}).error(function(){b("#uik-popup").removeClass("loader").empty().append("Error connection")})},validateZoom:function(){if(a.viewmodel.map.getZoom()<14){a.alerts.showAlert("zoom");return false}return true}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{uikSelected:null,uikSelectedId:null});b.extend(a.view,{});a.uiks_2012={};b.extend(a.uiks_2012,{init:function(){this.updatePoints();this.bindEvents()},bindEvents:function(){var c=this;a.view.$document.on("/uik/uiks_2012/updateUiks",function(){c.updatePoints()})},updatePoints:function(){var c=this.validateZoom();this.clearLayers();if(!c){return}a.view.$document.trigger("/uik/uiks_2012/startUpdate");this.updateUiksByAjax()},clearLayers:function(){a.viewmodel.mapLayers.points.uik_2012.clearLayers()},updateUiksByAjax:function(){var e=this,d=document.url_root+"uikp/all",c=a.viewmodel.filter,f={uik:c.uik.json,uik_2012:c.uik_2012.json};b.ajax({type:"GET",url:d,data:{bbox:JSON.stringify(a.viewmodel.map.getBounds()),center:JSON.stringify(a.viewmodel.map.getCenter()),filter:JSON.stringify(f)},dataType:"json",success:function(g){e.renderUiks(g);a.view.$document.trigger("/sm/searcher/update");a.view.$document.trigger("/sm/stops/endUpdate")},context:e})},renderUiks:function(h){var k=a.viewmodel,q=k.mapLayers.points,n=a.config.data.points,o=h.points.layers,p,g,m,j,l,d,f,e=a.templates.uikPopupTemplate({css:"edit"}),c=this;k.pointLayers.uiksp=h.points.layers;for(p in o){if(o.hasOwnProperty(p)){g=o[p].elements;m=o[p].count;if(m>0){l=n[p].createIcon()}for(f=0;f<m;f+=1){j=g[f];d=L.marker([j.lat,j.lon],{icon:l}).on("click",function(r){var i=r.target;a.view.$document.trigger("/uik/map/openPopup",[i.getLatLng(),e]);c.buildUikPopup(i.id)});d.id=j.id;q[p].addLayer(d)}}}},buildUikPopup:function(c){return b.getJSON(document.url_root+"uikp/"+c,function(e){var d=a.templates.uik2012PopupInfoTemplate({uikp:e.uikp});b("#uik-popup").removeClass("loader").empty().append(d)}).error(function(){b("#uik-popup").removeClass("loader").empty().append("Error connection")})},validateZoom:function(){if(a.viewmodel.map.getZoom()<14){a.alerts.showAlert("zoom");return false}return true}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{isAuth:false});b.extend(a.view,{$userContainer:null,$signInForm:null,$signOutForm:null});a.user={};b.extend(a.user,{init:function(){this.setDomOptions();this.bindEvents()},setDomOptions:function(){a.view.$userContainer=b("#userContainer");a.view.$signInForm=b("#signInForm");a.view.$signOutForm=b("#signOutForm");if(a.view.$userContainer.hasClass("inner")){a.viewmodel.isAuth=true}},bindEvents:function(){var c=this;b("#signOutForm div.log").off("click").on("click",function(){c.renderLogs()})},renderLogs:function(){var c=document.url_root+"logs";a.view.$document.trigger("/sm/common/setMainLoad");b.ajax({type:"GET",url:c,dataType:"json",success:function(e){var d=a.templates.userLogsTemplate({user_logs:e.uiks_by_users,count_all:e.count.all,count_editable:e.count.editable,percent:(e.count.editable/e.count.all*100).toFixed(2)});a.view.$body.removeClass("loader");a.view.$document.trigger("/sm/common/openPopup",["Статистика пользователей",d])}})}})})(jQuery,UIK);(function(b,a){b.extend(a.view,{$permalink:null,$fb_link:null});a.permalink={};b.extend(a.permalink,{init:function(){this.setDomOptions();this.bindEvents()},setDomOptions:function(){a.view.$permalink=b("#permalink");a.view.$fb_link=b("#rightPanel a.facebook")},bindEvents:function(){a.view.$document.on("/uik/permalink/update",function(f,g,e){var c=a.view,d=document.url_root+"?lat="+g.lat+"&lon="+g.lng+"&zoom="+e;c.$permalink.prop("href",d);c.$fb_link.prop("href","https://www.facebook.com/sharer/sharer.php?u="+d)})}})})(jQuery,UIK);(function(b,a){b.extend(a.viewmodel,{});b.extend(a.view,{$josmLink:null});a.josm={};b.extend(a.josm,{init:function(){this.bindEvents();this.setDomOptions()},setDomOptions:function(){a.view.$josmLink=b("#josm-link")},bindEvents:function(){b("#json_link").on("mouseover",function(){var c=a.viewmodel.map.getBounds(),d=("http://127.0.0.1:8111/load_and_zoom?left="+c.getNorthWest().lng+"&top="+c.getNorthWest().lat+"&right="+c.getSouthEast().lng+"&bottom="+c.getSouthEast().lat);b(this).attr("href",d)})}})})(jQuery,UIK);UIK.templates={};UIK.templates.alertsTemplate=Mustache.compile('<div id="alert_{{id}}" class="alert alert-{{type}}" style="display: none;"> <button type="button" class="close" data-dismiss="alert">&times;</button> <strong>{{statusText}}</strong> {{text}} </div>');UIK.templates.searchResultsTemplate=Mustache.compile('<ul class="{{cssClass}}"> {{#uiks}} <li data-lat={{lat}} data-lon={{lon}} data-id={{id}}> <span>{{name}}</span> {{addr}} <a class="target" title="Перейти к УИКу"></a> {{#isAuth}}<a class="edit" title="Редактировать УИК"></a>{{/isAuth}} </li> {{/uiks}} </ul>');UIK.templates.uik2012PopupInfoTemplate=Mustache.compile('<table class="table table-striped"> <tr> <td>Номер УИКа</td> <td>{{uikp.name}}</td> </tr> <tr> <td>Адрес</td> <td>{{uikp.address}}</td> </tr> <tr> <td>Комментарий</td> <td>{{uikp.comment}}</td> </tr> </table> ');UIK.templates.osmPopupTemplate=Mustache.compile('<div class="osm-popup"> <div class="caption"> <span>{{id}}</span> <a href="{{link}}" target="_blank" title="Посмотреть на OpenStreetMaps" class="osm"></a> </div> <table class="table table-striped"> {{#tags}} <tr> <td>{{key}}</td> <td>{{val}}</td> </tr> {{/tags}} </table> </div>');UIK.templates.versionsTemplate=Mustache.compile("<ul> <li> <b>v{{num}}</b> {{time}}, {{name}} </li> </ul>");UIK.templates.uikPopupTemplate=Mustache.compile('<div id="uik-popup" class="{{css}} loader"></div>');UIK.templates.uikPopupInfoTemplate=Mustache.compile('<table class="table table-striped"> <tr> <td>Номер УИКа</td> <td>{{uik.number_official}}</td> </tr> <tr> <td>ТИК</td> <td>{{tik.name}}</td> </tr> <tr> <td>Регион</td> <td>{{region.name}}</td> </tr> <tr> <td>Адрес голосования</td> <td>{{uik.address_voting}}</td> </tr> <tr> <td>Место помещения голосования</td> <td>{{uik.place_voting}}</td> </tr> <tr> <td>Точность геокодирования</td> <td>{{geo_precision.name_ru}}</td> </tr> <tr> <td>Комментарий</td> <td>{{uik.comment}}</td> </tr> <tr> <td>Проверен</td> <td> {{#uik.is_applied}}Да{{/uik.is_applied}} {{^uik.is_applied}}Нет{{/uik.is_applied}} </td> </tr> {{#isBlocked}} <tr class="block"> {{#isUnBlocked}} <td>Заблокирована вами</td> <td> <button class="btn btn-small btn-primary block" id="unblock" type="button">Разблокировать</button> </td> {{/isUnBlocked}} {{^isUnBlocked}} <td>Заблокировал</td> <td>{{userBlocked}}</td> {{/isUnBlocked}} </tr> {{/isBlocked}} </table> {{#isUserEditor}} <div class="edit"> <button class="btn btn-small btn-primary {{#isBlock}}block{{/isBlock}}" id="edit" type="button" {{#editDenied}}disabled="disabled"{{/editDenied}}>Редактировать</button> </div> {{/isUserEditor}} ');UIK.templates.userLogsTemplate=Mustache.compile('<table class="table table-striped logs"> <caption>Общая статистика</caption> <tr> <th>Показатель</th> <th>Значение</th> </tr> <tr> <td>Всего УИКов</td> <td class="stop">{{count_all}}</td> </tr> <tr> <td>Отредактировано УИКов</td> <td class="stop">{{count_editable}}</td> </tr> <tr> <td>Отредактировано, %</td> <td class="stop">{{percent}}</td> </tr> </table> <table class="table table-striped logs"> <caption>Статистика по пользователям</caption> <tr> <th>Пользователь</th> <th>Кол-во УИКов</th> </tr> {{#user_logs}} <tr> <td>{{user_name}}</td> <td class="stop">{{count_uiks}}</td> </tr> {{/user_logs}} </table>');